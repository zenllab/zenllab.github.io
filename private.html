<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Private · Zen Lab</title>
  <link rel="icon" href="assets/favicon.svg">
  <link rel="stylesheet" href="assets/style.css">
  <script defer src="assets/script.js"></script>
  <script defer src="assets/toDo.js"></script>

  <style>
  /* 기본 폰트 크기 및 색상 설정 */
  body, button, input, textarea {
    font-family: Arial, sans-serif;
    font-size: 16px; /* 기본 폰트 사이즈를 16px로 통일 */
    line-height: 1.5;
  }

  /* 네비게이션과 푸터 폰트 크기 조정 */
  .nav a, .footer div {
    font-size: 14px;
  }

  /* 메인 컨텐츠 영역의 폰트 사이즈 재설정 */
  .private-wrap {
    font-size: 16px;
  }

  /* 리스트의 기본 점 기호 제거 */
  .js-toDoList {
    list-style-type: none;
    padding-left: 0;
  }

  /* To-Do 리스트 아이템과 버튼 크기 통일 */
  .js-toDoList li {
    font-size: 16px; /* 리스트 아이템 폰트 크기 */
  }

  .js-toDoList button {
    font-size: 12px; /* X 버튼은 작게 유지 */
    padding: 2px 5px;
    background-color: transparent;
    border: none;
    cursor: pointer;
  }

  /* Rich Text Editor 스타일 */
  .rich-text-editor {
    width: 100%;
    min-height: 200px;
    border: 1px solid #ccc;
    padding: 10px;
    background-color: #f9f9f9;
    margin-top: 20px;
    font-size: 16px; /* 에디터 폰트 크기 통일 */
  }

  /* Calendar styles */
  .calendar-container {
      font-family: Arial, sans-serif;
      padding: 20px;
      border-radius: 8px;
      max-width: 400px;
      margin: 20px 0;
      background-color: #f0f0f0;
  }

  .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
  }

  .calendar-header button {
      background: none;
      border: none;
      font-size: 1.5em; /* 기존 크기 유지 (부모 폰트의 1.5배) */
      cursor: pointer;
  }

  .calendar-header h3 {
      font-size: 1.5em; /* 달력 제목 폰트 크기를 버튼과 동일하게 설정 */
  }

  .calendar-days, .calendar-dates {
      font-size: 16px; /* 요일과 날짜 폰트 크기 통일 */
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      text-align: center;
  }
  
  .calendar-days {
      font-weight: bold;
  }

  .calendar-dates div {
      padding: 10px;
      cursor: pointer;
  }
  
  .calendar-dates .selected-date {
      background-color: #007bff;
      color: white;
      border-radius: 50%;
  }
</style>

</head>
<body>
    <nav class="nav">
        <a class="logo" href="index.html">Zen Lab</a>
        <input id="menu-toggle" type="checkbox">
        <label class="menu-button-container" for="menu-toggle">
            <span class="menu-button"></span>
        </label>
        <ul class="menu">
            <li><a href="news.html">🎉News</a></li>
            <li><a href="research.html">Research</a></li>
            <li><a href="members.html">Members</a></li>
            <li><a href="publications.html">Publications</a></li>
            <li><a href="teaching.html">Teaching</a></li>
            <li><a href="contact.html">Contact</a></li>
        </ul>
    </nav>

    <main class="private-wrap">
    <section id="app">
        <form class="js-toDoForm">
            <input type="text" placeholder="Write a to do" />
            <button type="button" class="js-addBtn">Add</button>
        </form>
        <ul class="js-toDoList">
        </ul>

        <div class="report-editor">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h3 id="report-title">Daily Report - YYYY.MM.DD</h3>
                <button class="btn" id="saveBtn">Save Report</button>
                <button class="btn" id="uploadBtn">Upload to Dropbox</button>
            </div>
            <div class="rich-text-editor" id="report-content" contenteditable="true">
              <p>Write your daily report here...</p>
            </div>
        </div>
        
        <div class="calendar-container">
            <div class="calendar-header">
                <button id="prev-month">‹</button>
                <h3 id="month-year"></h3>
                <button id="next-month">›</button>
                <button id="today-btn">Today</button>
            </div>
            <div class="calendar-days">
                <div>Sun</div>
                <div>Mon</div>
                <div>Tue</div>
                <div>Wed</div>
                <div>Thu</div>
                <div>Fri</div>
                <div>Sat</div>
            </div>
            <div class="calendar-dates" id="calendar-dates"></div>
        </div>
    </section>
    
    <footer class="footer">
        <div>&copy; <span id="year"></span> Zen Lab. All rights reserved.</div>
    </footer>

    <script>
      const calendarDatesEl = document.getElementById('calendar-dates');
      const monthYearEl = document.getElementById('month-year');
      const prevBtn = document.getElementById('prev-month');
      const nextBtn = document.getElementById('next-month');
      const todayBtn = document.getElementById('today-btn');
      
      const reportTitleEl = document.getElementById('report-title');
      const reportContentEl = document.getElementById('report-content');
      const saveBtn = document.getElementById('saveBtn');

      const today = new Date();
      let currentDate = new Date();
      let selectedDate = new Date();

      const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

      // 날짜를 YYYY-MM-DD 형식의 문자열로 변환하는 함수
      function formatDate(date) {
          const year = date.getFullYear();
          const month = String(date.getMonth() + 1).padStart(2, '0');
          const day = String(date.getDate()).padStart(2, '0');
          return `${year}-${month}-${day}`;
      }
      
      function renderCalendar() {
          const year = currentDate.getFullYear();
          const month = currentDate.getMonth();

          const firstDayOfMonth = new Date(year, month, 1).getDay();
          const lastDateOfMonth = new Date(year, month + 1, 0).getDate();
          
          monthYearEl.textContent = `${monthNames[month]} ${year}`;
          calendarDatesEl.innerHTML = '';
          
          for (let i = 0; i < firstDayOfMonth; i++) {
              calendarDatesEl.innerHTML += '<div></div>';
          }
          
          for (let i = 1; i <= lastDateOfMonth; i++) {
              const dayEl = document.createElement('div');
              dayEl.textContent = i;
              dayEl.dataset.date = formatDate(new Date(year, month, i));
              
              if (dayEl.dataset.date === formatDate(selectedDate)) {
                  dayEl.classList.add('selected-date');
              }

              dayEl.addEventListener('click', () => {
                  selectedDate = new Date(year, month, i);
                  updateReportDisplay();
                  renderCalendar();
              });
              
              calendarDatesEl.appendChild(dayEl);
          }
      }

      function updateReportDisplay() {
          const dateKey = formatDate(selectedDate);
          reportTitleEl.textContent = `Daily Report - ${dateKey}`;
          const savedContent = localStorage.getItem(dateKey);
          
          const isToday = formatDate(selectedDate) === formatDate(today);

          if (isToday) {
              reportContentEl.contentEditable = "true";
              saveBtn.style.display = 'inline-block';
          } else {
              reportContentEl.contentEditable = "false";
              saveBtn.style.display = 'none';
          }

          if (savedContent) {
              reportContentEl.innerHTML = savedContent;
          } else {
              reportContentEl.innerHTML = '<p>No report for this date.</p>';
          }
      }

      function saveReport() {
          const dateKey = formatDate(selectedDate);
          localStorage.setItem(dateKey, reportContentEl.innerHTML);
          alert('Report saved!');
      }

      // 'Today' 버튼의 클릭 핸들러를 별도의 함수로 정의
      function handleTodayClick() {
          currentDate = new Date();
          selectedDate = new Date();
          updateReportDisplay();
          renderCalendar();
      }

      prevBtn.addEventListener('click', () => {
          currentDate.setMonth(currentDate.getMonth() - 1);
          renderCalendar();
      });

      nextBtn.addEventListener('click', () => {
          currentDate.setMonth(currentDate.getMonth() + 1);
          renderCalendar();
      });

      // 'Today' 버튼 이벤트 리스너를 정의된 함수로 연결
      todayBtn.addEventListener('click', handleTodayClick);
      
      saveBtn.addEventListener('click', saveReport);

      // 페이지가 로드될 때 자동으로 Today 클릭
      document.addEventListener('DOMContentLoaded', function() {
      handleTodayClick();
      });
    </script>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
<script>
  // 페이지가 로드될 때마다 로그인 상태 확인
  document.addEventListener('DOMContentLoaded', () => {
    if (window.netlifyIdentity) {
      // Netlify Identity 초기화 후 로그인 여부 확인
      window.netlifyIdentity.on('init', user => {
        // 로그인된 사용자가 아니면 login.html로 리디렉션
        if (!user) {
          window.location.href = '/login.html';
        } else {
          // 로그인된 경우 로컬 스토리지에 로그인 상태 저장
          localStorage.setItem('user', JSON.stringify(user));
        }
      });

      // 로그인 후에 리디렉션
      window.netlifyIdentity.on('login', user => {
        localStorage.setItem('user', JSON.stringify(user));
        window.location.href = '/private.html';
      });

      // 페이지가 로드될 때, 이미 로그인된 사용자 확인
      const loggedInUser = localStorage.getItem('user');
      if (loggedInUser) {
        // 이미 로그인된 경우, 계속 private 페이지에 접근
        window.location.href = '/private.html';
      }
    } else {
      // Netlify Identity 미설정 상태
      window.location.href = '/login.html';
    }
  });
</script>

<script>
      // 클라이언트가 버튼을 클릭하면 서버에 파일 업로드 요청을 보냅니다.
      document.getElementById('uploadBtn').addEventListener('click', function() {
        fetch('/upload', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ content: document.getElementById('report-content').innerHTML }) // 서버로 보낼 데이터
        })
        .then(response => response.json())
        .then(data => {
          alert('Report uploaded successfully!');
        })
        .catch(error => {
          console.error('Error uploading file', error);
        });
      });
    </script>

</body>
</html>
