<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Private Â· Zen Lab</title>
  <link rel="icon" href="assets/favicon.svg">
  <link rel="stylesheet" href="assets/style.css">
  <script defer src="assets/script.js"></script>
  <script defer src="assets/toDo.js"></script>

  <style>
  /* ê¸°ë³¸ í°íŠ¸ í¬ê¸° ë° ìƒ‰ìƒ ì„¤ì • */
  body, button, input, textarea {
    font-family: Arial, sans-serif;
    font-size: 16px; /* ê¸°ë³¸ í°íŠ¸ ì‚¬ì´ì¦ˆë¥¼ 16pxë¡œ í†µì¼ */
    line-height: 1.5;
  }

  /* ë„¤ë¹„ê²Œì´ì…˜ê³¼ í‘¸í„° í°íŠ¸ í¬ê¸° ì¡°ì • */
  .nav a, .footer div {
    font-size: 14px;
  }

  /* ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ì˜ í°íŠ¸ ì‚¬ì´ì¦ˆ ì¬ì„¤ì • */
  .private-wrap {
    font-size: 16px;
  }

  /* ë¦¬ìŠ¤íŠ¸ì˜ ê¸°ë³¸ ì  ê¸°í˜¸ ì œê±° */
  .js-toDoList {
    list-style-type: none;
    padding-left: 0;
  }

  /* To-Do ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œê³¼ ë²„íŠ¼ í¬ê¸° í†µì¼ */
  .js-toDoList li {
    font-size: 16px; /* ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ í°íŠ¸ í¬ê¸° */
  }

  .js-toDoList button {
    font-size: 12px; /* X ë²„íŠ¼ì€ ì‘ê²Œ ìœ ì§€ */
    padding: 2px 5px;
    background-color: transparent;
    border: none;
    cursor: pointer;
  }

  /* Rich Text Editor ìŠ¤íƒ€ì¼ */
  .rich-text-editor {
    width: 100%;
    min-height: 200px;
    border: 1px solid #ccc;
    padding: 10px;
    background-color: #f9f9f9;
    margin-top: 20px;
    font-size: 16px; /* ì—ë””í„° í°íŠ¸ í¬ê¸° í†µì¼ */
  }

  /* Calendar styles */
  .calendar-container {
      font-family: Arial, sans-serif;
      padding: 20px;
      border-radius: 8px;
      max-width: 400px;
      margin: 20px 0;
      background-color: #f0f0f0;
  }

  .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
  }

  .calendar-header button {
      background: none;
      border: none;
      font-size: 1.5em; /* ê¸°ì¡´ í¬ê¸° ìœ ì§€ (ë¶€ëª¨ í°íŠ¸ì˜ 1.5ë°°) */
      cursor: pointer;
  }

  .calendar-header h3 {
      font-size: 1.5em; /* ë‹¬ë ¥ ì œëª© í°íŠ¸ í¬ê¸°ë¥¼ ë²„íŠ¼ê³¼ ë™ì¼í•˜ê²Œ ì„¤ì • */
  }

  .calendar-days, .calendar-dates {
      font-size: 16px; /* ìš”ì¼ê³¼ ë‚ ì§œ í°íŠ¸ í¬ê¸° í†µì¼ */
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      text-align: center;
  }
  
  .calendar-days {
      font-weight: bold;
  }

  .calendar-dates div {
      padding: 10px;
      cursor: pointer;
  }
  
  .calendar-dates .selected-date {
      background-color: #007bff;
      color: white;
      border-radius: 50%;
  }
</style>

</head>
<body>
    <nav class="nav">
        <a class="logo" href="index.html">Zen Lab</a>
        <input id="menu-toggle" type="checkbox">
        <label class="menu-button-container" for="menu-toggle">
            <span class="menu-button"></span>
        </label>
        <ul class="menu">
            <li><a href="news.html">ğŸ‰News</a></li>
            <li><a href="research.html">Research</a></li>
            <li><a href="members.html">Members</a></li>
            <li><a href="publications.html">Publications</a></li>
            <li><a href="teaching.html">Teaching</a></li>
            <li><a href="contact.html">Contact</a></li>
        </ul>
    </nav>

    <main class="private-wrap">
    <section id="app">
        <form class="js-toDoForm">
            <input type="text" placeholder="Write a to do" />
            <button type="button" class="js-addBtn">Add</button>
        </form>
        <ul class="js-toDoList">
        </ul>

        <div class="report-editor">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h3 id="report-title">Daily Report - YYYY.MM.DD</h3>
                <button class="btn" id="saveBtn">Save Report</button>
                <button class="btn" id="uploadBtn">Upload to Dropbox</button>
            </div>
            <div class="rich-text-editor" id="report-content" contenteditable="true">
              <p>Write your daily report here...</p>
            </div>
        </div>
        
        <div class="calendar-container">
            <div class="calendar-header">
                <button id="prev-month">â€¹</button>
                <h3 id="month-year"></h3>
                <button id="next-month">â€º</button>
                <button id="today-btn">Today</button>
            </div>
            <div class="calendar-days">
                <div>Sun</div>
                <div>Mon</div>
                <div>Tue</div>
                <div>Wed</div>
                <div>Thu</div>
                <div>Fri</div>
                <div>Sat</div>
            </div>
            <div class="calendar-dates" id="calendar-dates"></div>
        </div>
    </section>
    
    <footer class="footer">
        <div>&copy; <span id="year"></span> Zen Lab. All rights reserved.</div>
    </footer>

    <script>
      const calendarDatesEl = document.getElementById('calendar-dates');
      const monthYearEl = document.getElementById('month-year');
      const prevBtn = document.getElementById('prev-month');
      const nextBtn = document.getElementById('next-month');
      const todayBtn = document.getElementById('today-btn');
      
      const reportTitleEl = document.getElementById('report-title');
      const reportContentEl = document.getElementById('report-content');
      const saveBtn = document.getElementById('saveBtn');

      const today = new Date();
      let currentDate = new Date();
      let selectedDate = new Date();

      const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

      // ë‚ ì§œë¥¼ YYYY-MM-DD í˜•ì‹ì˜ ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
      function formatDate(date) {
          const year = date.getFullYear();
          const month = String(date.getMonth() + 1).padStart(2, '0');
          const day = String(date.getDate()).padStart(2, '0');
          return `${year}-${month}-${day}`;
      }
      
      function renderCalendar() {
          const year = currentDate.getFullYear();
          const month = currentDate.getMonth();

          const firstDayOfMonth = new Date(year, month, 1).getDay();
          const lastDateOfMonth = new Date(year, month + 1, 0).getDate();
          
          monthYearEl.textContent = `${monthNames[month]} ${year}`;
          calendarDatesEl.innerHTML = '';
          
          for (let i = 0; i < firstDayOfMonth; i++) {
              calendarDatesEl.innerHTML += '<div></div>';
          }
          
          for (let i = 1; i <= lastDateOfMonth; i++) {
              const dayEl = document.createElement('div');
              dayEl.textContent = i;
              dayEl.dataset.date = formatDate(new Date(year, month, i));
              
              if (dayEl.dataset.date === formatDate(selectedDate)) {
                  dayEl.classList.add('selected-date');
              }

              dayEl.addEventListener('click', () => {
                  selectedDate = new Date(year, month, i);
                  updateReportDisplay();
                  renderCalendar();
              });
              
              calendarDatesEl.appendChild(dayEl);
          }
      }

      function updateReportDisplay() {
          const dateKey = formatDate(selectedDate);
          reportTitleEl.textContent = `Daily Report - ${dateKey}`;
          const savedContent = localStorage.getItem(dateKey);
          
          const isToday = formatDate(selectedDate) === formatDate(today);

          if (isToday) {
              reportContentEl.contentEditable = "true";
              saveBtn.style.display = 'inline-block';
          } else {
              reportContentEl.contentEditable = "false";
              saveBtn.style.display = 'none';
          }

          if (savedContent) {
              reportContentEl.innerHTML = savedContent;
          } else {
              reportContentEl.innerHTML = '<p>No report for this date.</p>';
          }
      }

      function saveReport() {
          const dateKey = formatDate(selectedDate);
          localStorage.setItem(dateKey, reportContentEl.innerHTML);
          alert('Report saved!');
      }

      // 'Today' ë²„íŠ¼ì˜ í´ë¦­ í•¸ë“¤ëŸ¬ë¥¼ ë³„ë„ì˜ í•¨ìˆ˜ë¡œ ì •ì˜
      function handleTodayClick() {
          currentDate = new Date();
          selectedDate = new Date();
          updateReportDisplay();
          renderCalendar();
      }

      prevBtn.addEventListener('click', () => {
          currentDate.setMonth(currentDate.getMonth() - 1);
          renderCalendar();
      });

      nextBtn.addEventListener('click', () => {
          currentDate.setMonth(currentDate.getMonth() + 1);
          renderCalendar();
      });

      // 'Today' ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ì •ì˜ëœ í•¨ìˆ˜ë¡œ ì—°ê²°
      todayBtn.addEventListener('click', handleTodayClick);
      
      saveBtn.addEventListener('click', saveReport);

      // í˜ì´ì§€ê°€ ë¡œë“œë  ë•Œ ìë™ìœ¼ë¡œ Today í´ë¦­
      document.addEventListener('DOMContentLoaded', function() {
      handleTodayClick();
      });
    </script>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
<script>
  // í˜ì´ì§€ê°€ ë¡œë“œë  ë•Œë§ˆë‹¤ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
  document.addEventListener('DOMContentLoaded', () => {
    if (window.netlifyIdentity) {
      // Netlify Identity ì´ˆê¸°í™” í›„ ë¡œê·¸ì¸ ì—¬ë¶€ í™•ì¸
      window.netlifyIdentity.on('init', user => {
        // ë¡œê·¸ì¸ëœ ì‚¬ìš©ìê°€ ì•„ë‹ˆë©´ login.htmlë¡œ ë¦¬ë””ë ‰ì…˜
        if (!user) {
          window.location.href = '/login.html';
        } else {
          // ë¡œê·¸ì¸ëœ ê²½ìš° ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ë¡œê·¸ì¸ ìƒíƒœ ì €ì¥
          localStorage.setItem('user', JSON.stringify(user));
        }
      });

      // ë¡œê·¸ì¸ í›„ì— ë¦¬ë””ë ‰ì…˜
      window.netlifyIdentity.on('login', user => {
        localStorage.setItem('user', JSON.stringify(user));
        window.location.href = '/private.html';
      });

      // í˜ì´ì§€ê°€ ë¡œë“œë  ë•Œ, ì´ë¯¸ ë¡œê·¸ì¸ëœ ì‚¬ìš©ì í™•ì¸
      const loggedInUser = localStorage.getItem('user');
      if (loggedInUser) {
        // ì´ë¯¸ ë¡œê·¸ì¸ëœ ê²½ìš°, ê³„ì† private í˜ì´ì§€ì— ì ‘ê·¼
        window.location.href = '/private.html';
      }
    } else {
      // Netlify Identity ë¯¸ì„¤ì • ìƒíƒœ
      window.location.href = '/login.html';
    }
  });
</script>

<script>
      // í´ë¼ì´ì–¸íŠ¸ê°€ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ì„œë²„ì— íŒŒì¼ ì—…ë¡œë“œ ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.
      document.getElementById('uploadBtn').addEventListener('click', function() {
        fetch('/upload', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ content: document.getElementById('report-content').innerHTML }) // ì„œë²„ë¡œ ë³´ë‚¼ ë°ì´í„°
        })
        .then(response => response.json())
        .then(data => {
          alert('Report uploaded successfully!');
        })
        .catch(error => {
          console.error('Error uploading file', error);
        });
      });
    </script>

</body>
</html>
