<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>Dropbox Auth Callback</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{font:14px/1.5 system-ui,Segoe UI,Helvetica,Arial;margin:0;padding:2rem;color:#111;background:#f8f9fa}
    .box{max-width:720px;margin:0 auto;background:white;padding:2rem;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,0.1)}
    .muted{color:#666}
    .success{color:#28a745}
    .error{color:#dc3545}
    code{background:#f6f8fa;padding:.1rem .3rem;border-radius:.25rem}
    .loading{display:inline-block;width:20px;height:20px;border:3px solid #f3f3f3;border-top:3px solid #3498db;border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin{0%{transform:rotate(0deg)} 100%{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <div class="box">
    <h1>üîó Dropbox Ïù∏Ï¶ù</h1>
    <div id="status">
      <div class="loading"></div>
      <span class="muted">Ïù∏Ï¶ù Ï≤òÎ¶¨ Ï§ë...</span>
    </div>
    <div id="details" class="muted" style="margin-top:1rem;"></div>
  </div>
  
  <script>
    (async () => {
      const statusEl = document.getElementById('status');
      const detailsEl = document.getElementById('details');
      
      function updateStatus(message, type = 'info', details = '') {
        let icon = '‚è≥';
        let className = 'muted';
        
        if (type === 'success') {
          icon = '‚úÖ';
          className = 'success';
        } else if (type === 'error') {
          icon = '‚ùå';
          className = 'error';
        }
        
        statusEl.innerHTML = `${icon} <span class="${className}">${message}</span>`;
        if (details) {
          detailsEl.innerHTML = `<small>${details}</small>`;
        }
      }

      try {
        // URLÏóêÏÑú ÏΩîÎìú Ï∂îÏ∂ú
        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get('code');
        const error = urlParams.get('error');
        
        if (error) {
          throw new Error(`Ïù∏Ï¶ù Ïò§Î•ò: ${error}`);
        }
        
        if (!code) {
          throw new Error('Ïù∏Ï¶ù ÏΩîÎìúÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
        }
        
        updateStatus('Ïù∏Ï¶ù ÏΩîÎìú ÌôïÏù∏Îê®, Ï≤òÎ¶¨ Ï§ë...', 'info');
        
        // Î©îÏù∏ ÌéòÏù¥ÏßÄÎ°ú ÏΩîÎìúÏôÄ Ìï®Íªò Î¶¨Îã§Ïù¥Î†âÌä∏
        // Î©îÏù∏ ÌéòÏù¥ÏßÄÏóêÏÑú ÏßÅÏ†ë Ï≤òÎ¶¨ÌïòÎèÑÎ°ù Î≥ÄÍ≤Ω
        const targetUrl = `/private.html?code=${encodeURIComponent(code)}`;
        
        updateStatus('Ïù∏Ï¶ù ÏÑ±Í≥µ! Î©îÏù∏ ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô Ï§ë...', 'success');
        
        setTimeout(() => {
          window.location.href = targetUrl;
        }, 1000);
        
      } catch (e) {
        console.error('Ïù∏Ï¶ù Ï≤òÎ¶¨ Ïò§Î•ò:', e);
        updateStatus('Ïù∏Ï¶ù Ïã§Ìå®', 'error', e.message);
        
        // 5Ï¥à ÌõÑ Î©îÏù∏ ÌéòÏù¥ÏßÄÎ°ú Î¶¨Îã§Ïù¥Î†âÌä∏
        setTimeout(() => {
          window.location.href = '/private.html';
        }, 5000);
      }
    })();
  </script>
</body>
</html>